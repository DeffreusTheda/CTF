/* This file was generated by the Hex-Rays decompiler version 8.4.0.240320.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


//-------------------------------------------------------------------------
// Function declarations

long long (**init_proc())(void);
void sub_1020();
// size_t strlen(const char *s);
// int printf(const char *format, ...);
// void srand(unsigned int seed);
// void *calloc(size_t nmemb, size_t size);
// void *malloc(size_t size);
// FILE *fopen(const char *filename, const char *modes);
// long long __isoc99_scanf(const char *, ...); weak
// size_t fwrite(const void *ptr, size_t size, size_t n, FILE *s);
// int rand(void);
// int _cxa_finalize(void *);
void __noreturn start(long long a1, long long a2, void (*a3)(void));
char *sub_1100();
long long sub_1130();
char *sub_1170();
long long sub_11B0();
char *sub_11B9();
long long xor();
long long sort(long long head);
long long create_linked_list();
void term_proc();
// int _libc_start_main(int (*main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// int __cxa_finalize(void *);
// long long _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN main;
void *off_4050 = &off_4050; // idb
char byte_4058; // weak
char *s; // idb
int dword_4068; // weak
long long qword_4070; // weak


//----- (0000000000001000) ----------------------------------------------------
long long (**init_proc())(void)
{
  long long (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (long long (**)(void))_gmon_start__();
  return result;
}
// 40D8: using guessed type long long _gmon_start__(void);

//----- (0000000000001020) ----------------------------------------------------
void sub_1020()
{
  JUMPOUT(0LL);
}
// 1026: control flows out of bounds to 0

//----- (00000000000010D0) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start(long long a1, long long a2, void (*a3)(void))
{
  long long v3; // rax
  int v4; // esi
  long long v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main((int (*)(int, char **, char **))main, v4, &retaddr, 0LL, 0LL, a3, &v5);
  __halt();
}
// 10D6: positive sp value 8 has been found
// 10DD: variable 'v3' is possibly undefined

//----- (0000000000001100) ----------------------------------------------------
char *sub_1100()
{
  return &byte_4058;
}
// 4058: using guessed type char byte_4058;

//----- (0000000000001130) ----------------------------------------------------
long long sub_1130()
{
  return 0LL;
}

//----- (0000000000001170) ----------------------------------------------------
char *sub_1170()
{
  char *result; // rax

  if ( !byte_4058 )
  {
    if ( &__cxa_finalize )
      _cxa_finalize(off_4050);
    result = sub_1100();
    byte_4058 = 1;
  }
  return result;
}
// 4058: using guessed type char byte_4058;

//----- (00000000000011B0) ----------------------------------------------------
// attributes: thunk
long long sub_11B0()
{
  return sub_1130();
}

//----- (00000000000011B9) ----------------------------------------------------
char *sub_11B9()
{
  char *result; // rax

  result = s;
  *s |= 1 << dword_4068;
  return result;
}
// 4068: using guessed type int dword_4068;

//----- (00000000000011E8) ----------------------------------------------------
long long xor()
{
  long long result; // rax

  result = *(_QWORD *)qword_4070;
  if ( *(_QWORD *)qword_4070 )
  {
    if ( *(_BYTE *)(qword_4070 + 8) > *(_BYTE *)(*(_QWORD *)qword_4070 + 8LL) )
    {
      *(_BYTE *)(*(_QWORD *)qword_4070 + 8LL) ^= *(_BYTE *)(qword_4070 + 8);
      *(_BYTE *)(qword_4070 + 8) ^= *(_BYTE *)(*(_QWORD *)qword_4070 + 8LL);
      *(_BYTE *)(*(_QWORD *)qword_4070 + 8LL) ^= *(_BYTE *)(qword_4070 + 8);
      sub_11B9();
    }
    qword_4070 = *(_QWORD *)qword_4070;
    if ( ++dword_4068 > 7 )
    {
      ++s;
      dword_4068 = 0;
    }
    return xor();
  }
  return result;
}
// 4068: using guessed type int dword_4068;
// 4070: using guessed type long long qword_4070;

//----- (00000000000012F1) ----------------------------------------------------
long long sort(long long head)
{
  long long result; // rax

  if ( --dword_4068 > 0 )
  {
    sort(head);
    xor();
  }
  result = head;
  qword_4070 = head;
  return result;
}
// 4068: using guessed type int dword_4068;
// 4070: using guessed type long long qword_4070;

//----- (0000000000001346) ----------------------------------------------------
long long create_linked_list()
{
  long long result; // rax
  _BYTE *v1; // [rsp+8h] [rbp-18h]
  _BYTE *v2; // [rsp+10h] [rbp-10h]
  unsigned long long i; // [rsp+18h] [rbp-8h]

  v2 = malloc(0x10uLL);
  qword_4070 = (long long)v2;
  v2[8] = 0;
  *(_QWORD *)v2 = 0LL;
  for ( i = 0LL; i < dword_4068; ++i )
  {
    v1 = malloc(0x10uLL);
    v1[8] = s[i];
    *(_QWORD *)v1 = 0LL;
    while ( *(_QWORD *)qword_4070 )
      qword_4070 = *(_QWORD *)qword_4070;
    *(_QWORD *)qword_4070 = v1;
  }
  result = *(_QWORD *)v2;
  qword_4070 = *(_QWORD *)v2;
  return result;
}
// 4068: using guessed type int dword_4068;
// 4070: using guessed type long long qword_4070;

//----- (0000000000001409) ----------------------------------------------------
long long main(int a1, char **a2, char **a3)
{
  long long v3; // rax
  long long v4; // rax
  long long v5; // rax
  FILE *s; // [rsp+0h] [rbp-40h]
  _BYTE *ptr; // [rsp+8h] [rbp-38h]
  size_t v9; // [rsp+10h] [rbp-30h]
  size_t j; // [rsp+18h] [rbp-28h]
  unsigned long long i; // [rsp+20h] [rbp-20h]
  _BYTE v12[9]; // [rsp+2Fh] [rbp-11h]
  char *v13; // [rsp+38h] [rbp-8h]

  ::s = (char *)calloc(0x64uLL, 1uLL);
  printf("Enter your input: ");
  scanf("%100s", ::s);
  v9 = strlen(::s);
  dword_4068 = v9;
  create_linked_list();
  ::s = (char *)calloc((int)((v9 * v9 + 7) >> 3), 1uLL);
  v13 = ::s;
  sort(qword_4070);
  ptr = calloc((int)(((v9 * v9 + 7) >> 3) + v9), 1uLL);
  v12[8] = 0;
  *(_QWORD *)v12 = *(unsigned __int8 *)(qword_4070 + 8);
  for ( i = 0LL; i < (v9 * v9 + 7) >> 3; ++i )
  {
    if ( qword_4070 )
    {
      v3 = (*(_QWORD *)&v12[1])++;
      ptr[v3] = *(_BYTE *)(qword_4070 + 8);
      v12[0] = *(_BYTE *)(qword_4070 + 8);
      qword_4070 = *(_QWORD *)qword_4070;
    }
    v4 = (*(_QWORD *)&v12[1])++;
    ptr[v4] = *v13++;
  }
  while ( qword_4070 )
  {
    v5 = (*(_QWORD *)&v12[1])++;
    ptr[v5] = *(_BYTE *)(qword_4070 + 8);
    v12[0] = *(_BYTE *)(qword_4070 + 8);
    qword_4070 = *(_QWORD *)qword_4070;
  }
  srand(v12[0]);
  for ( j = 0LL; j < ((v9 * v9 + 7) >> 3) + v9; ++j )
    ptr[j] ^= rand();
  s = fopen("output", "wb");
  fwrite(ptr, 1uLL, (int)(((v9 * v9 + 7) >> 3) + v9), s);
  return 0LL;
}
// 1090: using guessed type long long __isoc99_scanf(const char *, ...);
// 4068: using guessed type int dword_4068;
// 4070: using guessed type long long qword_4070;

//----- (00000000000016A8) ----------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=35 queued=13 decompiled=13 lumina nreq=0 worse=0 better=0
// ALL OK, 13 function(s) have been successfully decompiled
