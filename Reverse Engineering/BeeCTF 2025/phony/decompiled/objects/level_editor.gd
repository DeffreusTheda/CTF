extends Node2D

const in_edit_mode: bool = false
var current_level_name = "phony"

var fk_fall_time: float = 2.2
var fk_output_arr = [[], [], [], []]

var level_info = {
    "phony" = {
        "fk_times": "[[6.18675765991211, 6.56988677978516, 6.973332977294899, 7.3042179107666, 7.6583219528198, 8.0095239639282, 8.372336006164598, 8.691609954834, 9.106667137146001, 10.238639450073201, 10.462131118774401, 11.8611331939697, 12.4242168426514, 14.345668411254902, 14.6968704223633, 15.027755355835001, 16.7982765197754, 17.1814056396484, 17.535510635376, 18.9316097259521, 20.6702037811279, 21.0214057922363, 23.688798522949202, 24.211248016357402, 25.2561450958252, 26.495509719848602, 27.4126983642578, 28.8320175170898, 29.4589553833008, 30.933423614502, 31.4761901855469, 31.998639678955097, 32.6487976074219, 33.3628135681152, 33.7488418579102, 34.953378295898396, 35.6586853027344, 36.575872039794895, 37.533696746826195, 39.2084365844727, 39.774423217773396, 40.189477539062494, 41.1066680908203, 41.5014053344727, 41.864217376709, 42.2270294189453, 42.920724487304696, 43.956914520263695, 44.862493133544895, 46.0583206176758, 46.6765533447266, 47.8607727050781, 48.542855834960896, 49.6196838378906, 50.5049415588379, 51.401815032959, 52.4467102050781, 53.1723342895508, 54.771611785888695, 57.961450195312494, 58.3039451599121, 58.504216766357395, 58.675462341308595, 63.3571868896484, 64.0944229125977, 65.31056365966799, 66.03618774414059, 66.66603240966799, 67.316194152832, 67.6673904418945, 68.0185943603516, 68.7035842895508, 69.7484832763672, 70.80498657226559, 72.9383255004883, 73.2895217895508, 73.9600006103516, 74.3024917602539, 76.12526092529299, 76.4474349975586, 77.1730590820312, 80.3512893676758, 81.3961883544922, 82.1305252075195, 82.4846282958984, 82.8358245849609, 83.3147369384766, 84.4147811889648, 84.93723449707029, 85.26812133789059, 86.6555114746094, 87.0386367797852, 87.4014526367187, 87.7758728027344, 88.1590057373047, 88.4666687011719, 88.8207717895508, 89.1516586303711, 89.5028549194336, 89.85405883789059, 90.2371917724609, 90.5274368286133, 92.3618103027344, 93.7492080688477, 95.1453033447266, 96.23374328613279, 97.44988403320299, 98.163903808594, 98.66603240966799, 99.017236328125, 99.914102172852, 100.596192932129, 101.130250549316, 102.047441101074, 103.30421600341799, 103.667031860352, 105.034104919434, 105.939683532715, 106.644990539551, 107.176141357422, 107.507028198242, 109.10630187988299, 110.194741821289, 110.879724121094, 111.76498565673799, 112.328073120117, 113.149476623535, 113.512292480469, 114.194375610352, 114.708116149902, 115.410523986816, 117.033013916016, 117.70639190673799, 120.370881652832, 120.968797302246, 121.801812744141, 123.122445678711, 124.094781494141, 124.477914428711, 124.808801269531, 126.55899963378899, 127.41233215332001, 127.94638977050799, 129.023217773438], [9.289523696899401, 10.110930061340301, 11.8611331939697, 12.6273914337158, 12.894422149658201, 14.1628108978271, 15.211677169799799, 16.5863948822021, 17.1814056396484, 18.600724792480502, 20.3712478637695, 21.2245803833008, 23.218593215942402, 24.597278213501, 25.6102500915527, 26.8263946533203, 28.2747398376465, 28.501134490966802, 29.160001373291, 29.833379364013698, 30.367436981201198, 31.7112937927246, 32.3295227050781, 33.0116096496582, 34.6544204711914, 35.3365074157715, 36.073739624023396, 36.584580993652295, 37.4059844970703, 37.844262695312494, 38.5379577636719, 38.8891616821289, 39.774423217773396, 40.990567779540996, 41.428842163085896, 42.557912445068396, 43.475102996826195, 44.5316101074219, 45.405259704589795, 46.1947380065918, 46.7287994384766, 47.178685760498, 47.518277740478496, 48.2119728088379, 49.1494766235352, 50.098592376709, 51.070928192138695, 52.1042190551758, 52.821134185790996, 53.503221130371095, 54.269479370117196, 55.433377838134795, 57.822129821777295, 58.858323669433595, 60.425668334960896, 61.458955383300804, 62.175874328613304, 62.4080749511719, 62.6983200073242, 63.711289978027295, 64.4688430786133, 67.316194152832, 67.64707336425779, 68.0185943603516, 68.3494812011719, 69.05478820800779, 70.4508834838867, 71.1358734130859, 72.9383255004883, 73.2895217895508, 73.64072570800779, 74.4505249023437, 75.9133773803711, 76.84217987060549, 77.7042175292969, 78.3775955200195, 78.7287994384766, 79.09160766601559, 79.6575942993164, 79.9768692016602, 80.8621307373047, 81.7473922729492, 83.6136947631836, 84.1042190551758, 84.93723449707029, 85.9705215454102, 91.6245819091797, 93.023583984375, 94.4632202148437, 95.8593231201172, 96.959367370605, 97.812699890137, 99.144944763184, 99.914102172852, 100.596192932129, 101.684625244141, 102.590203857422, 103.315827941895, 103.658319091797, 105.405625915527, 106.270570373535, 107.646348571777, 107.893060302734, 108.392289733887, 110.54884490966799, 111.059686279297, 111.965257263184, 112.455781555176, 113.149476623535, 113.512292480469, 114.879365539551, 115.58176574707, 116.31900177002, 117.352288818359, 118.066300964355, 118.803536987305, 119.517549133301, 120.370881652832, 121.447709655762, 122.356187438965, 122.707391357422, 123.74358520507799, 124.477914428711, 124.808801269531, 127.08144531250001, 128.329522705078, 129.693688964844], [9.460771179199199, 9.875827407836901, 11.8814521789551, 13.149840927124, 13.962539291381802, 15.3789573669434, 16.4354644775391, 17.204625701904302, 18.1856685638428, 19.9881187438965, 21.3842178344727, 22.4407249450684, 22.77160987854, 23.860046005249, 25.2561450958252, 25.9730621337891, 26.3242622375488, 27.0266662597656, 27.4126983642578, 28.6288429260254, 29.3312469482422, 30.579320526123002, 30.933423614502, 31.850610351562498, 32.4775520324707, 33.2147842407227, 33.7488418579102, 35.081086730957, 36.2014518737793, 36.584580993652295, 37.257958984374994, 38.024217224121095, 38.3551002502441, 39.016870117187494, 39.774423217773396, 40.6596809387207, 41.289525604248, 41.843900299072295, 42.206712341308595, 42.9439445495605, 43.6260314941406, 44.691247558593695, 45.7477546691895, 46.3775955200195, 46.879727935790996, 47.8607727050781, 48.5631729125977, 49.277188873290996, 50.2814498901367, 51.4221321105957, 52.2551475524902, 52.989476776123, 53.874738311767594, 54.037278747558595, 55.122811889648396, 57.6102500915527, 59.177598571777295, 59.9119277954102, 61.2906127929687, 61.9814086914062, 63.0495239257812, 63.9144683837891, 64.8316589355469, 67.3365112304687, 67.64707336425779, 67.9982772827148, 68.7035842895508, 69.40598449707029, 71.1561904907227, 72.9383255004883, 73.2692047119141, 73.64072570800779, 74.6769195556641, 75.7537399291992, 76.9785934448242, 78.0467086791992, 78.94358215332029, 80.1597305297852, 81.2133346557617, 81.96217498779299, 82.3017669677734, 82.664582824707, 82.9838577270508, 84.25514373779299, 85.26812133789059, 86.3246246337891, 88.1357818603516, 89.52317199707029, 97.278642272949, 97.981042480469, 99.731248474121, 100.436555480957, 101.513375854492, 102.238999938965, 103.315827941895, 103.667031860352, 105.405625915527, 106.11093292236299, 106.80462799072299, 107.176141357422, 108.778321838379, 110.69687042236299, 111.326715087891, 112.180047607422, 112.809884643555, 113.512292480469, 115.079637145996, 115.796556091309, 116.68181762695299, 117.535150146484, 118.45233306884799, 120.19963989257799, 121.610246276855, 123.049890136719, 124.106393432617, 124.477914428711, 124.82041320800799, 127.241082763672, 128.712655639648, 130.111657714844, 130.483178710938], [6.18675765991211, 6.558276748657231, 6.9530158996582, 7.3042179107666, 7.6583219528198, 7.9892059326172005, 8.340407943725602, 8.703219985961901, 9.608798599243201, 9.7597280502319, 11.8611331939697, 12.1920181274414, 13.480725860595701, 13.7477546691895, 15.6459861755371, 15.9449440002441, 16.255509948730502, 17.204625701904302, 17.9824939727783, 19.6369167327881, 21.7383228302002, 22.249160385131802, 22.5684352874756, 23.0067115783691, 23.5088439941406, 24.8933330535889, 25.5986400604248, 26.6232200622559, 27.4126983642578, 27.9119277954102, 28.0947853088379, 28.9597297668457, 29.630204772949202, 29.993016815185502, 30.216508483886702, 30.9421325683594, 32.126348114013695, 32.8316551208496, 33.7488418579102, 34.3119293212891, 34.462857818603496, 34.782132720947295, 35.464215850830094, 35.850247955322295, 36.6078010559082, 37.086713409423794, 38.1751457214355, 39.3593650817871, 39.774423217773396, 40.1256233215332, 40.456506347656195, 41.1705223083496, 42.5811325073242, 43.327073669433595, 44.148480987548794, 45.0453506469727, 46.4849868774414, 46.9435821533203, 47.518277740478496, 48.1800437927246, 48.894059753418, 49.770612335205094, 50.696508026123, 51.050611114502, 51.7646270751953, 52.6179595947266, 53.5235382080078, 54.5916534423828, 56.307031249999994, 56.5102058410645, 56.6698394775391, 56.873014068603496, 57.044263458252, 57.203900909423794, 57.383855438232395, 59.177598571777295, 59.5404067993164, 60.5969177246094, 61.128076171874994, 61.813058471679696, 63.5400482177734, 64.2656723022461, 65.1509262084961, 65.84462890625, 66.5383239746094, 67.3365112304687, 67.64707336425779, 67.9982772827148, 68.3494812011719, 69.0663925170898, 70.0880752563477, 70.80498657226559, 72.9383255004883, 73.2692047119141, 73.97161254882809, 74.94394836425779, 75.2080703735352, 75.53895721435549, 77.3646255493164, 78.55755004882809, 79.2831741333008, 79.7011352539062, 80.6183258056641, 81.56743774414059, 83.4540573120117, 83.9997268676758, 84.5628143310547, 84.905305480957, 85.5990005493164, 88.8207717895508, 90.2371917724609, 90.9105697631836, 91.2617660522461, 91.60426483154299, 91.95546112060549, 92.3385940551758, 92.6607681274414, 93.023583984375, 93.374787902832, 93.7492080688477, 94.0771881103516, 94.43999633789059, 94.7824951171875, 95.1453033447266, 95.4965072631836, 95.8593231201172, 96.2105194091797, 96.5733352661133, 97.653062438965, 98.343858337402, 98.66603240966799, 99.731248474121, 100.436555480957, 101.887803649902, 102.984941101074, 103.315827941895, 103.658319091797, 104.70321807861299, 105.759729003906, 106.450524902344, 108.22104034423799, 110.003175354004, 110.345666503906, 113.512292480469, 114.02603302002, 115.976510620117, 117.160722351074, 117.886346435547, 118.963174438477, 119.688798522949, 120.19963989257799, 121.26775512695299, 121.973062133789, 122.332971191406, 122.707391357422, 123.36916503906299, 124.45758972168, 124.82041320800799, 126.88988647460899, 127.624215698242, 127.95510253906299, 129.374429321289]]", 
        "music": load("res://music/track.mp3")
    }
}

func _ready():

    $MusicPlayer.stream = level_info.get(current_level_name).get("music")
    $MusicPlayer.play()

    if in_edit_mode:
        Signals.KeyListenerPress.connect(KeyListenerPress)
    else:
        var fk_times = level_info.get(current_level_name).get("fk_times")
        var fk_times_arr = str_to_var(fk_times)

        var counter: int = 0
        for key in fk_times_arr:

            var button_name: String = ""
            match counter:
                0:
                    button_name = "button_Q"
                1:
                    button_name = "button_W"
                2:
                    button_name = "button_E"
                3:
                    button_name = "button_R"

            for delay in key:
                SpawnFallingKey(button_name, delay)

            counter += 1

func KeyListenerPress(button_name: String, array_num: int):

    fk_output_arr[array_num].append($MusicPlayer.get_playback_position() - fk_fall_time)

func SpawnFallingKey(button_name: String, delay: float):
    await get_tree().create_timer(delay).timeout
    Signals.CreateFallingKey.emit(button_name)


func _on_music_player_finished():
    print(fk_output_arr)
