/* This file was generated by the Hex-Rays decompiler version 8.4.0.240320.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
void sub_1020();
// int puts(const char *s);
// size_t strlen(const char *s);
// int printf(const char *format, ...);
// void *memcpy(void *dest, const void *src, size_t n);
// int __fastcall _cxa_finalize(void *);
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void));
void *sub_10B0();
__int64 sub_10E0();
void *sub_1120();
__int64 sub_1160();
unsigned __int64 __fastcall sub_1169(__int64 a1, unsigned __int64 a2, unsigned __int8 a3);
unsigned __int64 __fastcall sub_11CD(__int64 a1, unsigned __int64 a2, char a3);
unsigned __int64 __fastcall sub_124D(__int64 a1, unsigned __int64 a2, int a3, int a4);
unsigned __int64 __fastcall sub_12B8(__int64 a1, unsigned __int64 a2);
void *__fastcall sub_130C(void *a1, size_t a2, int a3);
__int64 sub_13F8();
void *__fastcall sub_14E2(const void *a1, size_t a2, __int64 a3, void *a4);
void term_proc();
// int __fastcall _libc_start_main(int (__fastcall *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// int __fastcall __cxa_finalize(void *);
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN main;
const char s = '\0'; // idb
void *off_4028 = &off_4028; // idb
_UNKNOWN unk_4030; // weak
char byte_4040; // weak
_BYTE byte_4060[256]; // weak


//----- (0000000000001000) ----------------------------------------------------
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 4198: using guessed type __int64 _gmon_start__(void);

//----- (0000000000001020) ----------------------------------------------------
void sub_1020()
{
  JUMPOUT(0LL);
}
// 1026: control flows out of bounds to 0

//----- (0000000000001080) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void))
{
  __int64 v3; // rax
  int v4; // esi
  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main((int (__fastcall *)(int, char **, char **))main, v4, &retaddr, 0LL, 0LL, a3, &v5);
  __halt();
}
// 1086: positive sp value 8 has been found
// 108D: variable 'v3' is possibly undefined

//----- (00000000000010B0) ----------------------------------------------------
void *sub_10B0()
{
  return &unk_4030;
}

//----- (00000000000010E0) ----------------------------------------------------
__int64 sub_10E0()
{
  return 0LL;
}

//----- (0000000000001120) ----------------------------------------------------
void *sub_1120()
{
  void *result; // rax

  if ( !byte_4040 )
  {
    if ( &__cxa_finalize )
      _cxa_finalize(off_4028);
    result = sub_10B0();
    byte_4040 = 1;
  }
  return result;
}
// 4040: using guessed type char byte_4040;

//----- (0000000000001160) ----------------------------------------------------
// attributes: thunk
__int64 sub_1160()
{
  return sub_10E0();
}

//----- (0000000000001169) ----------------------------------------------------
unsigned __int64 __fastcall sub_1169(__int64 a1, unsigned __int64 a2, unsigned __int8 a3)
{
  unsigned __int64 result; // rax
  unsigned __int64 i; // [rsp+1Ch] [rbp-8h]

  for ( i = 0LL; ; ++i )
  {
    result = i;
    if ( i >= a2 )
      break;
    *(_BYTE *)(a1 + i) = (*(unsigned __int8 *)(a1 + i) + i) % a3;
  }
  return result;
}

//----- (00000000000011CD) ----------------------------------------------------
unsigned __int64 __fastcall sub_11CD(__int64 a1, unsigned __int64 a2, char a3)
{
  unsigned __int64 result; // rax
  unsigned __int64 i; // [rsp+1Ch] [rbp-8h]

  for ( i = 0LL; ; ++i )
  {
    result = i;
    if ( i >= a2 )
      break;
    *(_BYTE *)(a1 + i) = ((int)*(unsigned __int8 *)(a1 + i) >> (8 - a3)) | (*(_BYTE *)(a1 + i) << a3);
  }
  return result;
}

//----- (000000000000124D) ----------------------------------------------------
unsigned __int64 __fastcall sub_124D(__int64 a1, unsigned __int64 a2, int a3, int a4)
{
  unsigned __int64 result; // rax
  unsigned __int64 i; // [rsp+20h] [rbp-8h]

  for ( i = 0LL; ; ++i )
  {
    result = i;
    if ( i >= a2 )
      break;
    *(_BYTE *)(a1 + i) = (a4 + a3 * *(unsigned __int8 *)(a1 + i)) % 256;
  }
  return result;
}

//----- (00000000000012B8) ----------------------------------------------------
unsigned __int64 __fastcall sub_12B8(__int64 a1, unsigned __int64 a2)
{
  unsigned __int64 result; // rax
  unsigned __int64 i; // [rsp+18h] [rbp-8h]

  for ( i = 0LL; ; ++i )
  {
    result = i;
    if ( i >= a2 )
      break;
    *(_BYTE *)(a1 + i) = byte_4060[*(unsigned __int8 *)(a1 + i)];
  }
  return result;
}
// 4060: using guessed type _BYTE byte_4060[256];

//----- (000000000000130C) ----------------------------------------------------
void *__fastcall sub_130C(void *a1, size_t a2)
{
  __int64 v5; // [rsp+0h] [rbp-50h] BYREF
  int v6; // [rsp+Ch] [rbp-44h]
  void *dest; // [rsp+18h] [rbp-38h]
  void *src; // [rsp+28h] [rbp-28h]
  size_t i; // [rsp+38h] [rbp-18h]

  dest = a1;
  n = a2;
  v6 = 2 % a2;
  if ( v6 < 0 )
    v6 += n;
  src = &v5;
  for ( i = 0LL; i < n; ++i )
    *((_BYTE *)src + i) = *((_BYTE *)dest + (n + i - v6) % n);
  return memcpy(dest, src, n);
}

//----- (00000000000013F8) ----------------------------------------------------
__int64 sub_13F8()
{
  __int64 result; // rax
  char v1; // [rsp+1h] [rbp-11h]
  int j; // [rsp+6h] [rbp-Ch]
  int i; // [rsp+Ah] [rbp-8h]
  unsigned int v4; // [rsp+Eh] [rbp-4h]

  v4 = 12345;
  for ( i = 0; i <= 255; ++i )
  {
    result = i;
    byte_4060[i] = i;
  }
  for ( j = 255; j > 0; --j )
  {
    v4 = (1103515245 * v4 + 12345) % 0x7FFFFFFF;
    v1 = byte_4060[j];
    byte_4060[j] = byte_4060[v4 % (j + 1)];
    result = (int)(v4 % (j + 1));
    byte_4060[result] = v1;
  }
  return result;
}
// 4060: using guessed type _BYTE byte_4060[256];

//----- (00000000000014E2) ----------------------------------------------------
void *__fastcall sub_14E2(const void *a1, size_t a2, __int64 a3, void *a4)
{
  void *result; // rax
  int i; // [rsp+2Ch] [rbp-4h]

  result = memcpy(a4, a1, a2);
  for ( i = 0; i <= 9; ++i )
  {
    sub_1169((__int64)a4, a2, 0xFFu);
    sub_11CD((__int64)a4, a2, 3);
    sub_124D((__int64)a4, a2, 5, 8);
    sub_12B8((__int64)a4, a2);
    result = sub_130C(a4, a2, 2);
  }
  return result;
}

//----- (000000000000159D) ----------------------------------------------------
__int64 __fastcall main(__int64 a1, char **a2, char **a3)
{
  void *v3; // rsp
  _BYTE v5[4]; // [rsp+0h] [rbp-50h] BYREF
  char s[12]; // [rsp+4h] [rbp-4Ch] BYREF
  __int64 v7[2]; // [rsp+10h] [rbp-40h] BYREF
  _BYTE *v8; // [rsp+20h] [rbp-30h]
  __int64 v9; // [rsp+28h] [rbp-28h]
  size_t v10; // [rsp+30h] [rbp-20h]
  size_t i; // [rsp+38h] [rbp-18h]

  sub_13F8();
  v7[0] = 0LL;
  v7[1] = 0LL;
  strcpy(s, "{fak3_fl4g}");
  v10 = strlen(s);
  v9 = v10 - 1;
  v3 = alloca(16 * ((v10 + 15) / 0x10));
  v8 = v5;
  sub_14E2(s, v10, (__int64)v7, v5);
  printf("Ciphertext: ");
  for ( i = 0LL; i < v10; ++i )
    printf("%d, ", (unsigned __int8)v8[i]);
  puts(&::s);
  puts("Encryption Done!");
  return 0LL;
}

//----- (00000000000016C0) ----------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=28 queued=16 decompiled=16 lumina nreq=0 worse=0 better=0
// ALL OK, 16 function(s) have been successfully decompiled
