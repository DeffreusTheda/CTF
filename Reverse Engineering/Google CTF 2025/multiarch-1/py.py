segdata = bytes([
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x10, 0x06, 0x87, 0x70, 
  0x08, 0x21, 0x04, 0x00, 0x00, 0x38, 0x0C, 0x21, 0x04, 0x00, 0x80, 0x20, 0x84, 0x10, 0x42, 0x08, 
  0x00, 0x08, 0x21, 0xBC, 0xA1, 0xA0, 0x87, 0x20, 0x2C, 0x00, 0xB0, 0x00, 0x0C, 
])

segcode = bytes([
  0x10, 0x4B, 0x00, 0x00, 0x00, 0x30, 0x00, 0x20, 0x00, 0x00, 0x10, 0x02, 0x00, 0x00, 0x00, 0xA0, 
  0x00, 0x00, 0x00, 0x00, 0x10, 0x2B, 0x00, 0x00, 0x00, 0x30, 0xAD, 0x20, 0x00, 0x00, 0x10, 0x02, 
  0x00, 0x00, 0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0xA0, 0x00, 0x00, 
  0x00, 0x00, 0x20, 0x37, 0x13, 0x00, 0x00, 0x20, 0x39, 0x05, 0x00, 0x00, 0x30, 0x09, 0x53, 0x67, 
  0x08, 0x62, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x30, 0xAA, 0xAA, 0xAA, 0xAA, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x72, 0x0B, 0x11, 0x00, 0x00, 0xC5, 0x02, 0x00, 0x00, 0x00, 0xCD, 
  0xD8, 0x20, 0x00, 0x00, 0xD5, 0x1E, 0x00, 0x00, 0x00, 0x01, 0x31, 0x50, 0x20, 0x00, 0x00, 0x00, 
  0xCE, 0x12, 0xD5, 0x20, 0x00, 0x00, 0x00, 0xC5, 0x01, 0x00, 0x00, 0x00, 0x01, 0x15, 0xCD, 0x20, 
  0x00, 0x00, 0x00, 0x60, 0x1C, 0x11, 0x00, 0x00, 0x80, 0x31, 0x73, 0x00, 0x00, 0x63, 0x0B, 0x11, 
  0x00, 0x00, 0xC5, 0x00, 0x00, 0x00, 0x00, 0x10, 0x5A, 0x00, 0x00, 0x00, 0x30, 0xF6, 0x20, 0x00, 
  0x00, 0x10, 0x02, 0x00, 0x00, 0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xC8, 0xC5, 0x03, 0x00, 
  0x00, 0x00, 0x01, 0xD5, 0x00, 0x00, 0x00, 0x00, 0x60, 0x45, 0x11, 0x00, 0x00, 0x10, 0xFF, 0xFF, 
  0xFF, 0x00, 0x11, 0x63, 0x00, 0x00, 0x00, 0x00, 0x30, 0xEE, 0xFF, 0xC0, 0x00, 0x80, 0x00, 0x00, 
  0x00, 0x00, 0x71, 0xEC, 0x10, 0x00, 0x00, 0x21, 0x30, 0x01, 0x00, 0x00, 0x00, 0x82, 0x0A, 0x00, 
  0x00, 0x00, 0x62, 0x0B, 0x11, 0x00, 0x00, 0x68, 0xB8, 0x10, 0x00, 0x00, 0xD5, 0x39, 0x00, 0x00, 
  0x00, 0xCD, 0x74, 0x20, 0x00, 0x00, 0xC5, 0x02, 0x00, 0x00, 0x00, 0x01, 0x10, 0x05, 0x00, 0x00, 
  0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x70, 0x1B, 0x11, 0x00, 0x00, 0xD5, 0x29, 0x00, 0x00, 0x00, 
  0xCD, 0x4B, 0x20, 0x00, 0x00, 0xC5, 0x02, 0x00, 0x00, 0x00, 0x01, 0x00, 0xD0, 0x20, 0x12, 0x11, 
  0xCD, 0x00, 0x00, 0x00, 0x00, 0xA1, 0xDA, 0x51, 0x40, 0xBE, 0xBA, 0xFE, 0xCA, 0x40, 0x24, 0x15, 
  0x11, 0x72, 0x62, 0x42, 0x11, 0x00, 0x00, 0x21, 0x30, 0x04, 0x00, 0x00, 0x00, 0x68, 0x25, 0x11, 
  0x00, 0x00, 0xC1, 0x61, 0x01, 0xC5, 0x00, 0x37, 0x13, 0x00, 0x10, 0x04, 0x00, 0x00, 0x00, 0xA0, 
  0x00, 0x00, 0x00, 0x00, 0x16, 0x40, 0x12, 0x11, 0x30, 0xF2, 0xF2, 0xF2, 0xF2, 0x62, 0x00, 0x00, 
  0x00, 0x00, 0x15, 0x61, 0x00, 
])

r_pc = 0x1000
r_heap = 0x8F00
stack = []

def bittest(base, bit):
  if (bit < 0 or bit >= (4 * 8)):
    # Bit out of range
    return -1

  return (base >> bit) & 1

def chose_vm():
  choose = r_pc
  choose_1 = choose - 0xFF9
  if ( choose - 0x1000 >= 0 ):
    choose_1 = r_pc - 0x1000
  v3 = segdata[choose_1 >> 3]
  print(hex(r_pc), bittest(v3, choose & 7))

def pop4():
  a = stack.pop()
  b = stack.pop()
  c = stack.pop()
  d = stack.pop()
  return (a << 24) | (b << 16) | (c << 8) | d

def stackvm():
  opcode = segcode[r_pc]
  match(opcode):
    case 0x10:
      stack.append(segcode[r_pc + 1])
      r_pc += 5
    case 0x20:
      stack.append(segcode[r_pc + 1])
      stack.append(segcode[r_pc + 2])
      r_pc += 5
    case 0x30:
      stack.append(segcode[r_pc + 1])
      stack.append(segcode[r_pc + 2])
      stack.append(segcode[r_pc + 3])
      stack.append(segcode[r_pc + 4])
      r_pc += 5
    case 0x40:
      print('WARNING 0x40')
      exit(0)
    case 0x50:
      b = pop4()
      r_pc += 5
    case 0x60:
      a = pop4()
      b = pop4()
      x = a + b
      a = (x >> 24) & 0xff
      b = (x >> 16) & 0xff
      c = (x >> 8) & 0xff
      d = x & 8
      stack.append(a)
      stack.append(b)
      stack.append(c)
      stack.append(d)
    case 0x70:

while True:
  input()
  v1 = chose_vm()
  if (v1 == 0):
    stackvm()
  else:
    # regvm()