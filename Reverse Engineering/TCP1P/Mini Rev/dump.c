/* This file was generated by the Hex-Rays decompiler version 8.4.0.240320.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
void sub_2020();
void sub_2030();
void sub_2040();
void sub_2050();
void sub_2060();
void sub_2070();
void sub_2080();
void sub_2090();
void sub_20A0();
void sub_20B0();
void sub_20C0();
void sub_20D0();
void sub_20E0();
void sub_20F0();
void sub_2100();
void sub_2110();
void sub_2120();
void sub_2130();
void sub_2140();
void sub_2150();
void sub_2160();
void sub_2170();
void sub_2180();
void sub_2190();
void sub_21A0();
void sub_21B0();
void sub_21C0();
void sub_21D0();
void sub_21E0();
void sub_21F0();
void sub_2200();
void sub_2210();
void sub_2220();
// int __fastcall _cxa_finalize(void *);
// __int64 __fastcall std::allocator<char>::~allocator(_QWORD); weak
// void *__fastcall __cxa_begin_catch(void *);
// __int64 __fastcall std::string::basic_string(_QWORD, _QWORD); weak
// size_t strlen(const char *s);
// __int64 __fastcall std::string::~string(_QWORD); weak
// __int64 __fastcall std::string::_M_set_length(_QWORD, _QWORD); weak
// void __fastcall __noreturn std::__throw_logic_error(const char *); idb
// __int64 __fastcall std::ofstream::is_open(_QWORD); weak
// __int64 __fastcall std::string::_M_local_data(_QWORD); weak
// __int64 __fastcall std::string::_M_data(_QWORD, _QWORD); weak
// int __fastcall __cxa_atexit(void (__fastcall *lpfunc)(void *), void *obj, void *lpdso_handle);
// __int64 __fastcall std::operator<<<char>(_QWORD, _QWORD); weak
// __int64 __fastcall std::ostream::operator<<(_QWORD, _QWORD); weak
// __int64 __fastcall std::string::_Alloc_hider::_Alloc_hider(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::allocator<char>::~allocator(_QWORD); weak
// __int64 __fastcall std::ofstream::basic_ofstream(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::string::_M_data(_QWORD); weak
// __int64 __fastcall std::string::operator[](_QWORD, _QWORD); weak
// __int64 __fastcall std::string::_S_copy_chars(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::string::_M_dispose(_QWORD); weak
// __int64 __fastcall std::ofstream::close(_QWORD); weak
// void __noreturn __cxa_rethrow(void);
// __int64 __fastcall std::ofstream::~ofstream(_QWORD); weak
// __int64 __fastcall std::string::length(_QWORD); weak
// _QWORD std::ios_base::Init::Init(std::ios_base::Init *__hidden this); idb
// __int64 __fastcall std::allocator<char>::allocator(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::string::_M_create(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall std::string::_M_capacity(_QWORD, _QWORD); weak
// __int64 __fastcall std::string::operator[](_QWORD, _QWORD); weak
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void));
char *deregister_tm_clones();
__int64 register_tm_clones();
char *_do_global_dtors_aux();
__int64 frame_dummy(); // weak
__int64 __fastcall xorMessage(__int64 a1, __int64 a2, __int64 a3);
int __fastcall main(int argc, const char **argv, const char **envp);
int __fastcall __static_initialization_and_destruction_0(int a1, int a2);
int GLOBAL__sub_I__Z10xorMessageRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_();
size_t __fastcall std::char_traits<char>::length(const char *a1);
bool __fastcall __gnu_cxx::char_traits<char>::eq(_BYTE *a1, _BYTE *a2);
__int64 __fastcall __gnu_cxx::char_traits<char>::length(__int64 a1);
__int64 __fastcall std::string::_Alloc_hider::~_Alloc_hider(__int64 a1);
unsigned __int64 __fastcall std::string::basic_string<std::allocator<char>>(__int64 a1, const char *a2, __int64 a3);
__int64 __fastcall std::distance<char const*>(__int64 a1, __int64 a2);
unsigned __int64 __fastcall std::string::_M_construct<char const*>(__int64 a1, __int64 a2, __int64 a3);
bool __fastcall __gnu_cxx::__is_null_pointer<char const>(__int64 a1);
void std::__iterator_category<char const*>();
__int64 __fastcall std::__distance<char const*>(__int64 a1, __int64 a2);
void term_proc();
// int __fastcall _libc_start_main(int (__fastcall *main)(int, char **, char **), int argc, char **ubp_av, void (*init)(void), void (*fini)(void), void (*rtld_fini)(void), void *stack_end);
// void __fastcall std::ios_base::Init::~Init(std::ios_base::Init *__hidden this); idb
// int __fastcall __cxa_finalize(void *);
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

const char aV[] = "v\""; // idb
void *_dso_handle = &_dso_handle; // idb
char _bss_start; // weak
_UNKNOWN std::__ioinit; // weak
// extern _UNKNOWN std::endl<char,std::char_traits<char>>; weak


//----- (0000000000002000) ----------------------------------------------------
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    return (__int64 (**)(void))_gmon_start__();
  return result;
}
// 5158: using guessed type __int64 _gmon_start__(void);

//----- (0000000000002020) ----------------------------------------------------
void sub_2020()
{
  JUMPOUT(0LL);
}
// 2026: control flows out of bounds to 0

//----- (0000000000002030) ----------------------------------------------------
void sub_2030()
{
  sub_2020();
}

//----- (0000000000002040) ----------------------------------------------------
void sub_2040()
{
  sub_2020();
}

//----- (0000000000002050) ----------------------------------------------------
void sub_2050()
{
  sub_2020();
}

//----- (0000000000002060) ----------------------------------------------------
void sub_2060()
{
  sub_2020();
}

//----- (0000000000002070) ----------------------------------------------------
void sub_2070()
{
  sub_2020();
}

//----- (0000000000002080) ----------------------------------------------------
void sub_2080()
{
  sub_2020();
}

//----- (0000000000002090) ----------------------------------------------------
void sub_2090()
{
  sub_2020();
}

//----- (00000000000020A0) ----------------------------------------------------
void sub_20A0()
{
  sub_2020();
}

//----- (00000000000020B0) ----------------------------------------------------
void sub_20B0()
{
  sub_2020();
}

//----- (00000000000020C0) ----------------------------------------------------
void sub_20C0()
{
  sub_2020();
}

//----- (00000000000020D0) ----------------------------------------------------
void sub_20D0()
{
  sub_2020();
}

//----- (00000000000020E0) ----------------------------------------------------
void sub_20E0()
{
  sub_2020();
}

//----- (00000000000020F0) ----------------------------------------------------
void sub_20F0()
{
  sub_2020();
}

//----- (0000000000002100) ----------------------------------------------------
void sub_2100()
{
  sub_2020();
}

//----- (0000000000002110) ----------------------------------------------------
void sub_2110()
{
  sub_2020();
}

//----- (0000000000002120) ----------------------------------------------------
void sub_2120()
{
  sub_2020();
}

//----- (0000000000002130) ----------------------------------------------------
void sub_2130()
{
  sub_2020();
}

//----- (0000000000002140) ----------------------------------------------------
void sub_2140()
{
  sub_2020();
}

//----- (0000000000002150) ----------------------------------------------------
void sub_2150()
{
  sub_2020();
}

//----- (0000000000002160) ----------------------------------------------------
void sub_2160()
{
  sub_2020();
}

//----- (0000000000002170) ----------------------------------------------------
void sub_2170()
{
  sub_2020();
}

//----- (0000000000002180) ----------------------------------------------------
void sub_2180()
{
  sub_2020();
}

//----- (0000000000002190) ----------------------------------------------------
void sub_2190()
{
  sub_2020();
}

//----- (00000000000021A0) ----------------------------------------------------
void sub_21A0()
{
  sub_2020();
}

//----- (00000000000021B0) ----------------------------------------------------
void sub_21B0()
{
  sub_2020();
}

//----- (00000000000021C0) ----------------------------------------------------
void sub_21C0()
{
  sub_2020();
}

//----- (00000000000021D0) ----------------------------------------------------
void sub_21D0()
{
  sub_2020();
}

//----- (00000000000021E0) ----------------------------------------------------
void sub_21E0()
{
  sub_2020();
}

//----- (00000000000021F0) ----------------------------------------------------
void sub_21F0()
{
  sub_2020();
}

//----- (0000000000002200) ----------------------------------------------------
void sub_2200()
{
  sub_2020();
}

//----- (0000000000002210) ----------------------------------------------------
void sub_2210()
{
  sub_2020();
}

//----- (0000000000002220) ----------------------------------------------------
void sub_2220()
{
  sub_2020();
}

//----- (0000000000002440) ----------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __fastcall __noreturn start(__int64 a1, __int64 a2, void (*a3)(void))
{
  __int64 v3; // rax
  int v4; // esi
  __int64 v5; // [rsp-8h] [rbp-8h] BYREF
  char *retaddr; // [rsp+0h] [rbp+0h] BYREF

  v4 = v5;
  v5 = v3;
  _libc_start_main((int (__fastcall *)(int, char **, char **))main, v4, &retaddr, 0LL, 0LL, a3, &v5);
  __halt();
}
// 244A: positive sp value 8 has been found
// 2451: variable 'v3' is possibly undefined

//----- (0000000000002470) ----------------------------------------------------
char *deregister_tm_clones()
{
  return &_bss_start;
}
// 5018: using guessed type char _bss_start;

//----- (00000000000024A0) ----------------------------------------------------
__int64 register_tm_clones()
{
  return 0LL;
}

//----- (00000000000024E0) ----------------------------------------------------
char *_do_global_dtors_aux()
{
  char *result; // rax

  if ( !_bss_start )
  {
    if ( &__cxa_finalize )
      _cxa_finalize(_dso_handle);
    result = deregister_tm_clones();
    _bss_start = 1;
  }
  return result;
}
// 5018: using guessed type char _bss_start;

//----- (0000000000002520) ----------------------------------------------------
__int64 frame_dummy()
{
  return register_tm_clones();
}
// 2520: using guessed type __int64 frame_dummy();

//----- (0000000000002529) ----------------------------------------------------
__int64 __fastcall xorMessage(__int64 a1, __int64 a2, __int64 a3)
{
  char v3; // bl
  char v4; // bl
  int i; // [rsp+28h] [rbp-18h]
  int v8; // [rsp+2Ch] [rbp-14h]

  std::string::basic_string(a1, a2);
  v8 = std::string::length(a3);
  for ( i = 0; i < (unsigned __int64)std::string::length(a2); ++i )
  {
    v3 = *(_BYTE *)std::string::operator[](a2, i);
    v4 = *(_BYTE *)std::string::operator[](a3, i % v8) ^ v3;
    *(_BYTE *)std::string::operator[](a1, i) = v4;
  }
  return a1;
}
// 2260: using guessed type __int64 __fastcall std::string::basic_string(_QWORD, _QWORD);
// 2350: using guessed type __int64 __fastcall std::string::operator[](_QWORD, _QWORD);
// 23C0: using guessed type __int64 __fastcall std::string::length(_QWORD);
// 2430: using guessed type __int64 __fastcall std::string::operator[](_QWORD, _QWORD);

//----- (0000000000002606) ----------------------------------------------------
int __fastcall main(int argc, const char **argv, const char **envp)
{
  const char *v3; // rsi
  __int64 v4; // rdx
  int v5; // ebx
  __int64 v6; // rax
  char v8; // [rsp+1Fh] [rbp-281h] BYREF
  char v9[32]; // [rsp+20h] [rbp-280h] BYREF
  char v10[32]; // [rsp+40h] [rbp-260h] BYREF
  char v11[32]; // [rsp+60h] [rbp-240h] BYREF
  char v12[520]; // [rsp+80h] [rbp-220h] BYREF
  unsigned __int64 v13; // [rsp+288h] [rbp-18h]

  v13 = __readfsqword(0x28u);
  std::allocator<char>::allocator(&v8, argv, envp);
  v3 = argv[1];
  std::string::basic_string<std::allocator<char>>((__int64)v9, v3, (__int64)&v8);
  std::allocator<char>::~allocator(&v8);
  std::allocator<char>::allocator(&v8, v3, v4);
  std::string::basic_string<std::allocator<char>>((__int64)v10, aV, (__int64)&v8);
  std::allocator<char>::~allocator(&v8);
  xorMessage((__int64)v11, (__int64)v9, (__int64)v10);
  std::ofstream::basic_ofstream(v12, "enc.txt", 16LL);
  if ( (unsigned __int8)std::ofstream::is_open(v12) != 1 )
  {
    v5 = 1;
  }
  else
  {
    v6 = std::operator<<<char>(v12, v11);
    std::ostream::operator<<(v6, &std::endl<char,std::char_traits<char>>);
    std::ofstream::close(v12);
    v5 = 0;
  }
  std::ofstream::~ofstream(v12);
  std::string::~string(v11);
  std::string::~string(v10);
  std::string::~string(v9);
  return v5;
}
// 2681: variable 'v4' is possibly undefined
// 2280: using guessed type __int64 __fastcall std::string::~string(_QWORD);
// 22B0: using guessed type __int64 __fastcall std::ofstream::is_open(_QWORD);
// 22F0: using guessed type __int64 __fastcall std::operator<<<char>(_QWORD, _QWORD);
// 2300: using guessed type __int64 __fastcall std::ostream::operator<<(_QWORD, _QWORD);
// 2320: using guessed type __int64 __fastcall std::allocator<char>::~allocator(_QWORD);
// 2330: using guessed type __int64 __fastcall std::ofstream::basic_ofstream(_QWORD, _QWORD, _QWORD);
// 2390: using guessed type __int64 __fastcall std::ofstream::close(_QWORD);
// 23B0: using guessed type __int64 __fastcall std::ofstream::~ofstream(_QWORD);
// 2400: using guessed type __int64 __fastcall std::allocator<char>::allocator(_QWORD, _QWORD, _QWORD);

//----- (0000000000002849) ----------------------------------------------------
int __fastcall __static_initialization_and_destruction_0(int a1, int a2)
{
  int result; // eax

  if ( a1 == 1 && a2 == 0xFFFF )
  {
    std::ios_base::Init::Init((std::ios_base::Init *)&std::__ioinit);
    return __cxa_atexit((void (__fastcall *)(void *))&std::ios_base::Init::~Init, &std::__ioinit, &_dso_handle);
  }
  return result;
}

//----- (000000000000289F) ----------------------------------------------------
int GLOBAL__sub_I__Z10xorMessageRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_()
{
  return __static_initialization_and_destruction_0(1, 0xFFFF);
}

//----- (00000000000028B8) ----------------------------------------------------
size_t __fastcall std::char_traits<char>::length(const char *a1)
{
  return strlen(a1);
}

//----- (00000000000028F6) ----------------------------------------------------
bool __fastcall __gnu_cxx::char_traits<char>::eq(_BYTE *a1, _BYTE *a2)
{
  return *a1 == *a2;
}

//----- (000000000000291C) ----------------------------------------------------
__int64 __fastcall __gnu_cxx::char_traits<char>::length(__int64 a1)
{
  char v2; // [rsp+1Fh] [rbp-11h] BYREF
  __int64 i; // [rsp+20h] [rbp-10h]
  unsigned __int64 v4; // [rsp+28h] [rbp-8h]

  v4 = __readfsqword(0x28u);
  for ( i = 0LL; ; ++i )
  {
    v2 = 0;
    if ( __gnu_cxx::char_traits<char>::eq((_BYTE *)(i + a1), &v2) )
      break;
  }
  return i;
}

//----- (000000000000298A) ----------------------------------------------------
__int64 __fastcall std::string::_Alloc_hider::~_Alloc_hider(__int64 a1)
{
  return std::allocator<char>::~allocator(a1);
}
// 2240: using guessed type __int64 __fastcall std::allocator<char>::~allocator(_QWORD);

//----- (00000000000029AA) ----------------------------------------------------
unsigned __int64 __fastcall std::string::basic_string<std::allocator<char>>(__int64 a1, const char *a2, __int64 a3)
{
  __int64 v3; // rax
  __int64 v4; // rax
  unsigned __int64 v7; // [rsp+38h] [rbp-18h]

  v7 = __readfsqword(0x28u);
  v3 = std::string::_M_local_data(a1);
  std::string::_Alloc_hider::_Alloc_hider(a1, v3, a3);
  if ( a2 )
    v4 = (__int64)&a2[std::char_traits<char>::length(a2)];
  else
    v4 = 1LL;
  std::string::_M_construct<char const*>(a1, (__int64)a2, v4);
  return v7 - __readfsqword(0x28u);
}
// 22C0: using guessed type __int64 __fastcall std::string::_M_local_data(_QWORD);
// 2310: using guessed type __int64 __fastcall std::string::_Alloc_hider::_Alloc_hider(_QWORD, _QWORD, _QWORD);

//----- (0000000000002A6D) ----------------------------------------------------
__int64 __fastcall std::distance<char const*>(__int64 a1, __int64 a2)
{
  std::__iterator_category<char const*>();
  return std::__distance<char const*>(a1, a2);
}

//----- (0000000000002AA2) ----------------------------------------------------
unsigned __int64 __fastcall std::string::_M_construct<char const*>(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v4; // rax
  __int64 v5; // rax
  unsigned __int64 v8; // [rsp+20h] [rbp-20h] BYREF
  unsigned __int64 v9; // [rsp+28h] [rbp-18h]

  v9 = __readfsqword(0x28u);
  if ( __gnu_cxx::__is_null_pointer<char const>(a2) && a2 != a3 )
    std::__throw_logic_error("basic_string::_M_construct null not valid");
  v8 = std::distance<char const*>(a2, a3);
  if ( v8 > 0xF )
  {
    v4 = std::string::_M_create(a1, &v8, 0LL);
    std::string::_M_data(a1, v4);
    std::string::_M_capacity(a1, v8);
  }
  v5 = std::string::_M_data(a1);
  std::string::_S_copy_chars(v5, a2, a3);
  std::string::_M_set_length(a1, v8);
  return v9 - __readfsqword(0x28u);
}
// 2290: using guessed type __int64 __fastcall std::string::_M_set_length(_QWORD, _QWORD);
// 22D0: using guessed type __int64 __fastcall std::string::_M_data(_QWORD, _QWORD);
// 2340: using guessed type __int64 __fastcall std::string::_M_data(_QWORD);
// 2360: using guessed type __int64 __fastcall std::string::_S_copy_chars(_QWORD, _QWORD, _QWORD);
// 2380: using guessed type __int64 __fastcall std::string::_M_dispose(_QWORD);
// 2410: using guessed type __int64 __fastcall std::string::_M_create(_QWORD, _QWORD, _QWORD);
// 2420: using guessed type __int64 __fastcall std::string::_M_capacity(_QWORD, _QWORD);

//----- (0000000000002BE7) ----------------------------------------------------
bool __fastcall __gnu_cxx::__is_null_pointer<char const>(__int64 a1)
{
  return a1 == 0;
}

//----- (0000000000002BFD) ----------------------------------------------------
void std::__iterator_category<char const*>()
{
  ;
}

//----- (0000000000002C0B) ----------------------------------------------------
__int64 __fastcall std::__distance<char const*>(__int64 a1, __int64 a2)
{
  return a2 - a1;
}

//----- (0000000000002C28) ----------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=125 queued=54 decompiled=54 lumina nreq=0 worse=0 better=0
// ALL OK, 54 function(s) have been successfully decompiled

