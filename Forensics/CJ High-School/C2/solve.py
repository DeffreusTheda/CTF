from Crypto.Cipher import AES
import sys

def decrypt_message(encrypted_data):
    # The AES key from the decompiled code
    key = bytes([
        0xa7, 0xd3, 0x5e, 0x2f, 0xb8, 0x81, 0xf6, 0xc4,
        0x90, 0xde, 0x6a, 0xc9, 0x3b, 0x7e, 0x8f, 0xe2
    ])

    # Create cipher object and decrypt the data
    cipher = AES.new(key, AES.MODE_ECB)
    decrypted = cipher.decrypt(encrypted_data)
    
    # Remove padding
    try:
        return decrypted.rstrip(b'\0').decode('utf-8')
    except UnicodeDecodeError:
        return decrypted.hex()

def main():
    # if len(sys.argv) != 2:
        # print(f"Usage: {sys.argv[0]} <encrypted_file>")
        # sys.exit(1)

    encrypted = [
        b'\xa7\xcf\xa1\xff\xa4\xd5\xb5\x7d\x23\x5a\x29\x6e\xb1\x2f\x91\x26',
        b'\x15\xe0\x97\xd3\x65\xd8\x9f\x1b\x2d\x00\x47\x77\x33\x27\x32\x4e',
        b'\x3a\x54\x9d\xf6\xb1\xdc\x24\x26\x73\x46\x07\xa3\x15\xe9\x79\xd6\xb4\xe6\x1f\xf1\x2f\xc0\x05\xfd\x06\x94\xcb\xf4\xd7\x2e\x4b\x61',
        b'\x4a\xfa\x2a\x52\xb1\x60\x99\x4a\x36\x26\xd1\xa7\x46\xad\x09\x7b\x9e\x72\x88\xee\xf6\xb9\xa8\x0a\xc8\x38\xdf\x9c\x16\x25\xab\x5c\x76\xd1\x37\xdc\x37\xda\xfe\x59\x62\x14\xce\x37\x02\x1e\xfc\x01\x34\x7a\xdb\xc6\xaf\x38\x10\x18\xfc\x13\x66\xa2\x57\xba\x3e\x88\x29\xba\xa2\xac\xda\x8a\xe0\x38\x56\x7a\xb0\x21\xfb\xd8\x2b\x4b\x01\x23\x73\x24\xf3\xed\x8a\x09\xee\x03\x11\x9d\x92\x19\x99\x50\xd9\xb8\x34\x66\x68\x2c\x8a\xcc\x0b\x5a\xa2\x02\xd8\xa2\x06\x23',
        b'\x07\x5d\x96\xbe\x20\x96\x1a\x30\x8e\x2b\x86\xf7\x1b\x71\xce\xd2\x68\xae\xea\xf1\x25\x9d\x0e\xdf\xbd\xcf\x71\xf6\xc6\x9a\x37\xe3'
        b'\x07\x5d\x96\xbe\x20\x96\x1a\x30\x8e\x2b\x86\xf7\x1b\x71\xce\xd2\x00\xe4\xe0\xa2\x93\xf4\xc2\x22\x91\xe1\x4e\x7e\x36\x61\x25\x98'
        b'\x15\xe0\x97\xd3\x65\xd8\x9f\x1b\x2d\x00\x47\x77\x33\x27\x32\x4e'
        b'\x88\x62\xb7\x48\x61\xef\xd8\xea\x9b\xc5\x06\x37\x7c\xe8\xc4\xbc'
    ]
    # try:
    #     with open(sys.argv[1], 'rb') as f:
    #         encrypted_data = f.read()
    # except FileNotFoundError:
    #     print(f"Error: Could not open file {sys.argv[1]}")
    #     sys.exit(1)

    # The original protocol used a 4-byte length prefix, but we'll just decrypt everything
    # If you have the length-prefixed data, you'll need to skip the first 4 bytes

    for encrypted_data in encrypted:
        decrypted = decrypt_message(encrypted_data)
        print(f"Decrypted message: {decrypted}")

if __name__ == "__main__":
    main()
